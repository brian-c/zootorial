Giant rewrite in progress.

To re-implement:

* Progress indication

To document:

* Everything.
